$(document).ready(function(){
	var panelText = 
	[
		{
			_id: 0,
			_title: "Sobre el proyecto",
			_text: "<b>¿Qué es?</b></br> La Partitura es una plataforma digital multimedia e interactiva, que recopila, visualiza y vincula una serie de eventos noticiosos (impresos y digitales) sobre el proyecto Calama Plus. Desarrollada por el el <a href='http://visualizacionycontroversias.cl/' target='_blank'>Grupo de Estudio sobre Visualización y Controversias</a> en el marco del proyecto de investigación ‘Nueva gobernabilidad emergencia y gestión de disyuntivas públicas en Chile”, esta plataforma permite una navegación temporal a través de los diferentes actores, ámbitos, conflictos e interacciones que se desprenden del corpus informativo sobre Calama Plus. </br></br> En otras palabras, esta plataforma forma ofrece una forma de visualización de ciertas situaciones problemáticas, precipitando situaciones de diálogo y debate entre los actores involucrados. </br></br> Esta plataforma está diseñada como una herramienta de exploración abierta, que permite tanto al equipo de investigación como a nuevos colaboradores, ir retroalimentando y enriqueciendo el material sobre los diferentes argumentos, intereses, actores y conflictos involucrados en este hecho. En otras palabras, esta plataforma permite cartografiar las relaciones y asociaciones, consensos y disensos, definiciones y conceptos que se fueron desarrollando alrededor del proyecto urbano. </br></br> <b>Qué es CALAMA PLUS</b></br> La versión actualmente disponible despliega eventos noticiosos relacionados con el Plan Calama Plus (en adelante PCP), publicados entre 2010 y 2015. El PCP es la respuesta que el gobierno central y la gran minería da a las demandas levantadas por los movimientos ciudadanos de 2010. Con un fuerte liderazgo edilicio, lo que estos movimientos reivindican de manera unitaria es la percepción de un contraste injusto entre el aporte que la zona entrega a la economía de Chile versus la magra calidad de vida que ofrece la ciudad. </br></br> En su origen, el PCP tiene como meta pagar la deuda histórica de Chile con Calama. Como moneda de cambio propone la planificación e implementación de una infraestructura urbana moderna y sustentable para esta ciudad. El PCP pretende reunir, consolidar y complementar 'diversos planes inconclusos pasados (PEDUC, Bicentenario, Nueva Calama, Calama Oasis, entre otros), a través del reordenamiento en torno a una visión de desarrollo sustentable de la ciudad y propone una implementación en un esquema de trabajo colaborativo público-privado, considerando un periodo de ejecución de 14 años, desde 2012 hasta el 2025.' (Calama Plus, 2016) </br></br> 'A partir de allí se establece el Consorcio Calama PLUS, entidad que tiene como misión la implementación del Plan Urbano Sustentable con el mismo nombre. Dicha entidad la componen diversos actores del mundo público y privado, quienes de una forma conjunta y colaborativa toman decisiones para la formulación, gestión, financiamiento y ejecución de los proyectos comprometidos en el Plan, conforme a su interés en la materialización de iniciativas para generar una mejor calidad de vida y una Calama sustentable acorde a su realidad económica.' (Calama Plus, 2016) </br></br> Si bien las manifestaciones ciudadanas se han reducido en frecuencia, convocatoria e intensidad, el interés que hoy presenta Calama Plus como caso de estudio radica en que las tensiones que originaron las protestas del 2010 siguen presentes en las personas pero ausentes de los medios noticiosos. A pesar de que la aparición en la escena calameña del PCP coincide con el apaciguamiento de los movimientos ciudadanos -coincidencia interpretada por algunos de los actores como la dilución del conflicto-, ni el malestar de los diversos colectivos y agrupaciones que participaron de las manifestaciones del 2010 ni las controversias respecto de la calidad de vida en Calama han desaparecido. </br></br> Consecuentemente, como instrumento, la Partitura Calama Plus es parte de una investigación mayor."
		},
		{
			_id: 1,
			_title: "Metodología",
			_text: "Al día de hoy, la base de datos de esta aplicación cuenta con 350 noticias. Para la búsqueda de noticias asociadas a Calama Plus se consultaron tanto fuentes de prensa local (Calama) como nacional. Los medios indagados fueron noticias y video publicados en la web y prensa digital. Éstas fueron organizadas según las siguientes categorías y sub-categorías:</br></br> <ol class='ol-met'> <li>ÁMBITO <ul class='ul-met'> <li>Economía</li> <li>Política</li> <li>Infraestructura Urbana</li> <li>Social</li> <li>Medioambiente</li> </ul> </li> <li>CONFLICTO <ul class='ul-met'> <li>Deuda Histórica/Centralismo</li> <li>Cuestionamiento Político</li> <li>Prácticas Antisindicales</li> <li>Condiciones Calama PLUS</li> <li>Alteración del ecosistema</li> </ul> </li> <li>INTERACCIÓN <ul class='ul-met'> <li>Declaración</li> <li>Entrega Documento</li> <li>Interpelación</li> <li>Socialización</li> <li>Convocatoria</li> <li>Consulta Ciudadana</li> <li>Manifestación Social</li> </ul> </li> <li>ACTORES <ul class='ul-met'> <li>Político</li> <li>Empresas</li> <li>Consorcio Calama PLUS</li> <li>Organización Laboral</li> <li>Organización Estudiantil </li> <li>Grupo Social</li> <li>Asociación Religiosa</li> <li>Pueblos Indígenas</li> <li>Medioambientales</li> <li>Medio de Comunicación</li> </ul> </li> </ol>"
		},
		{
			_id: 2,
			_title: "Definición de Categorías",
			_text: "La organización del corpus informativos en base a categorías responde a dos desafíos principales del proyecto investigativo:</br></br> - Ofrecer una lectura en términos de las <b>dinámicas de las controversias</b> del corpus de información recopilada, esto es, generar un modelo de visualización que considere las texturas, ritmos y configuraciones que pueden darse frente a un hecho problemático.</br></br> - Ofrecer una estructuración y visualización que se haga cargo de la heterogeneidad de posiciones, intereses, voces y argumentos, actores y conflictos, involucrados en una situación problemática.</br></br> <ul class='ul-top-cat'> <li class='li-top-cat'><b>ÁMBITO:</b> Se entiende por ámbito diferentes dominios temáticos donde transcurren y se desenvuelven, mayoritariamente, los hechos noticiosos en torno a Calama PLUS.</br> <ul class='ul-met ul-cat'> <li>Economía</li> <li>Política</li> <li>Infraestructura Urbana</li> <li>Social</li> <li>Medioambiente</li> </ul> </li> <li class='li-top-cat'><b>CONFLICTO:</b> Se entiende por Conflicto diferentes reivindicaciones, expectativas y estados que generan disputa e insatisfacción a un determinado grupos de actores vinculados directa o indirectamente con Calama PLUS.</br> <ul class='ul-met ul-cat'> <li>Deuda Histórica/Centralismo</li> <li>Cuestionamiento Político</li> <li>Prácticas Antisindicales</li> <li>Condiciones Calama PLUS</li> <li>Alteración del ecosistema</li> </ul> </li> <li class='li-top-cat'><b>INTERACCIÓN:</b> Se entiende por Interacción los modos en que los actores involucrados en un determinado conflicto buscan resolver o visibilizar su reivindicaciones, expectativas o insatisfacción.</br> <ul class='ul-met ul-cat'> <li>Declaración</li> <li>Entrega Documento</li> <li>Interpelación</li> <li>Socialización</li> <li>Convocatoria</li> <li>Consulta Ciudadana</li> <li>Manifestación Social</li> </ul> </li> <li class='li-top-cat'><b>ACTORES:</b> Se entiende por Actores los diferentes grupos de presión (personas, organizaciones, empresas, colectivos, etc.) que tienen interés de interactuar y movilizar algún tipo de causa en algunos de los ámbitos de Calama PLUS.</br> <ul class='ul-met ul-cat'> <li>Político</li> <li>Empresas</li> <li>Consorcio Calama PLUS</li> <li>Organización Laboral</li> <li>Organización Estudiantil </li> <li>Grupo Social</li> <li>Asociación Religiosa</li> <li>Pueblos Indígenas</li> <li>Medioambientales</li> <li>Medio de Comunicación</li> </ul> </li> </ul>"
		}
	];


	$(".menu-body").height($(window).height()-50);

	$.each($(".tl-timemarker"), function(index, value) {
		var title = $(value).attr("data-title").toLowerCase();
		var media = $(value).attr("data-media");
		var mediatype = $(value).attr("data-mediatype");

		$(value).qtip({
            style: {
                //classes: area,
                tip: false
            },
            content: {
                text: "<div class='tooltip-top'><p class='tooltip-title'>"+ title +"</p></div><div class='tooltip-down'><div class='tooltip-down-l'><p class='tooltip-media'>"+ media +"</p></div><div class='tooltip-down-r'><p class='tooltip-mediatype'>"+ mediatype +"</p></div></div>"
            },
            position: {
                my: 'bottom left',
                at: 'top left',
				/*target: 'mouse',*/
                adjust: {
                	x: 0,
                	y: 200
                }
            },
            show: {
                event: 'mouseenter'
            },
            hide: {
                event: 'mouseleave',
            }
        })
	});

	$(".tl-timemarker").hover(
	  function() {
	  	var group = $(this).attr("data-group");
	  	$(".tl-timemarker").addClass("low-opacity");
	    $(".tl-timemarker[data-group='"+ group +"']").removeClass("low-opacity");
	    $(".tl-timemarker[data-group='"+ group +"']").find(".tl-timemarker-content-container").addClass("full-opacity");
	  }, function() {
	    $(".tl-timemarker").removeClass("low-opacity");
	    $(".tl-timemarker").find(".tl-timemarker-content-container").removeClass("full-opacity");
	  }
	);

	$(document).on('click',".tl-timemarker",function(){
		var id = parseInt($(this).attr("data-hasqtip"));
		history.pushState(null, null, "?news=" + id);
	});

	$(document).on('click',".tutorialIcon",function(){
		$(".overMaskContainer").removeClass("hidden");
		$(".mask").removeClass("hidden");
	});

	$(document).on('click',".overMaskContainer",function(){
		$(".overMaskContainer").addClass("hidden");
		$(".mask").addClass("hidden");
	});

	$(document).on('click',".menuBtn",function(){
		$(".menu-display").slideToggle("fast");
		$(".menu-body").slideUp("fast");
	});

	$(document).on('click',".menu-display-list li",function(){
		var id = $(this).attr("data-id");
		var elem = $.grep(panelText, function(e){ return e._id == parseInt(id); })[0];
		$(".menu-body-title p").html(elem._title);
		$(".menu-body-content").html(elem._text);

		$(".menu-display").hide();
		$(".menu-body").show();
	});

	$(document).on('click',".menu-body-title",function(){
		$(".menu-body").hide();
		$(".menu-display").show();
	});

	$('#filter-dropdown').on('change', function (e) {
	    var valueSelected = this.value;

	    $(".tl-background-line").addClass("hidden");
	    $(".tl-background-label").addClass("hidden");
	    $(".tl-background-square").addClass("hidden");
	    $(".tl-timemarker-content-container").addClass("hidden");

	    if(valueSelected==0){
	    	$(".tl-background-line.int").removeClass("hidden");
	    	$(".tl-background-label.int").removeClass("hidden");
	    	$(".tl-background-square.int").removeClass("hidden");
	    	$(".tl-timemarker-content-container.int").removeClass("hidden");
	    }
	    else if(valueSelected==1){
			$(".tl-background-line.amb").removeClass("hidden");
	    	$(".tl-background-label.amb").removeClass("hidden");
	    	$(".tl-background-square.amb").removeClass("hidden");
	    	$(".tl-timemarker-content-container.amb").removeClass("hidden");
	    }
	    else if(valueSelected==2){
	    	$(".tl-background-line.conf").removeClass("hidden");
	    	$(".tl-background-label.conf").removeClass("hidden");
	    	$(".tl-background-square.conf").removeClass("hidden");
	    	$(".tl-timemarker-content-container.conf").removeClass("hidden");
	    }
	    else if(valueSelected==3){
	    	$(".tl-background-line.act").removeClass("hidden");
	    	$(".tl-background-label.act").removeClass("hidden");
	    	$(".tl-background-square.act").removeClass("hidden");
	    	$(".tl-timemarker-content-container.act").removeClass("hidden");
	    }

	    $.each($(".tl-text"), function(index, value){
	    	var inter = $(value).attr("data-int");
	    	var amb = $(value).attr("data-amb");
	    	var conf = $(value).attr("data-conf");
	    	var act = $(value).attr("data-act");

	    	if(valueSelected==0){
	    		//Tile de arriba a la derecha
	    		$(value).find(".tl-text-content-container-triple-left-conf-title").html("CONFLICTO");
	    		$(value).find(".tl-text-content-container-triple-left-conf-content").html(conf);

	    		//Tile de abajo a la izquierda
	    		$(value).find(".tl-ambito-title").html("ÁMBITO");
	    		$(value).find(".tl-ambito-content").html(amb);

	    		//Tile de abajo a la derecha
	    		$(value).find(".tl-text-content-container-triple-left-int-title").html("ACTORES");
	    		$(value).find(".tl-text-content-container-triple-left-int-content").html(act);
		    }
		    else if(valueSelected==1){
		    	//Tile de arriba a la derecha
	    		$(value).find(".tl-text-content-container-triple-left-conf-title").html("INTERACCIÓN");
	    		$(value).find(".tl-text-content-container-triple-left-conf-content").html(inter);

	    		//Tile de abajo a la izquierda
	    		$(value).find(".tl-ambito-title").html("CONFLICTO");
	    		$(value).find(".tl-ambito-content").html(conf);

	    		//Tile de abajo a la derecha
	    		$(value).find(".tl-text-content-container-triple-left-int-title").html("ACTORES");
	    		$(value).find(".tl-text-content-container-triple-left-int-content").html(act);
		    }
		    else if(valueSelected==2){
		    	//Tile de arriba a la derecha
	    		$(value).find(".tl-text-content-container-triple-left-conf-title").html("INTERACCIÓN");
	    		$(value).find(".tl-text-content-container-triple-left-conf-content").html(inter);

	    		//Tile de abajo a la izquierda
	    		$(value).find(".tl-ambito-title").html("ÁMBITO");
	    		$(value).find(".tl-ambito-content").html(amb);

	    		//Tile de abajo a la derecha
	    		$(value).find(".tl-text-content-container-triple-left-int-title").html("ACTORES");
	    		$(value).find(".tl-text-content-container-triple-left-int-content").html(act);
		    }
		    else if(valueSelected==3){
		    	//Tile de arriba a la derecha
	    		$(value).find(".tl-text-content-container-triple-left-conf-title").html("INTERACCIÓN");
	    		$(value).find(".tl-text-content-container-triple-left-conf-content").html(inter);

	    		//Tile de abajo a la izquierda
	    		$(value).find(".tl-ambito-title").html("ÁMBITO");
	    		$(value).find(".tl-ambito-content").html(amb);

	    		//Tile de abajo a la derecha
	    		$(value).find(".tl-text-content-container-triple-left-int-title").html("CONFLICTO");
	    		$(value).find(".tl-text-content-container-triple-left-int-content").html(conf);
		    }
	    });
	});

	$('#square-dropdown').on('change', function (e) {
	    var valueSelected = this.value;

	    $.each($(".tl-timemarker-content-container"), function(index,value){
	    	var sArray = $(value).attr("data-size").split(",");
	    	var tArray = $(value).attr("data-top").split(",");

	    	$(this).removeClass (function (index, css) {
			    return (css.match (/(^|\s)square-container-\S+/g) || []).join(' ');
			});

	    	if(sArray[valueSelected]==0 || sArray[valueSelected]=='0'){
	    		$(this).addClass("square-container-small");
	    		$(this).css("top", tArray[0]);
	    	}
	    	else if(sArray[valueSelected]==1 || sArray[valueSelected]=='1'){
	    		$(this).addClass("square-container-medium");
	    		$(this).css("top", tArray[1]);
	    	}
	    	else if(sArray[valueSelected]==2 || sArray[valueSelected]=='2'){
	    		$(this).addClass("square-container-large");
	    		$(this).css("top", tArray[2]);
	    	}
	    })
	});
});

(function($) {
    $.QueryString = (function(a) {
        if (a == "") return {};
        var b = {};
        for (var i = 0; i < a.length; ++i)
        {
            var p=a[i].split('=');
            if (p.length != 2) continue;
            b[p[0]] = decodeURIComponent(p[1].replace(/\+/g, " "));
        }
        return b;
    })(window.location.search.substr(1).split('&'))
})(jQuery);